<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SynBio Builder (v2)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --bg:#ffffff; --card:#f8f8f8; --border:#e3e3e3; --accent:#2e7d32;
      --muted:#666; --chip:#eef2ff;
    }
    body{font-family:system-ui,Arial;margin:16px;max-width:960px;background:var(--bg)}
    h1{margin:0 0 12px}
    .box{border:1px solid var(--border);border-radius:12px;padding:12px;margin:12px 0;background:var(--card)}
    h2{margin:6px 0}
    .pill{padding:4px 8px;border-radius:999px;background:#eee;margin-left:8px;font-size:12px}
    .bar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .bar input{padding:6px 8px;border:1px solid var(--border);border-radius:8px}
    .timer{font-weight:700}
    .opts{display:grid;grid-template-columns:1fr;gap:8px}
    @media (min-width:720px){ .opts{grid-template-columns:1fr 1fr} }
    details.opt{border:1px solid var(--border);border-radius:10px;background:#fff}
    details.opt[open]{box-shadow:0 2px 8px rgba(0,0,0,.05)}
    .opt summary{list-style:none;padding:10px 12px;display:flex;align-items:center;gap:10px;font-weight:600;cursor:pointer}
    .opt summary::-webkit-details-marker{display:none}
    .meta{margin-left:auto;font-weight:600;font-size:12px;color:var(--muted);display:flex;gap:8px}
    .badge{background:var(--chip);padding:2px 8px;border-radius:999px}
    .desc{padding:8px 12px 12px;color:#222;font-size:14px;line-height:1.35}
    .actions{display:flex;gap:8px;padding:0 12px 12px}
    .btn{border:1px solid var(--border);background:#f7f7f7;padding:8px 10px;border-radius:8px;cursor:pointer}
    .btn.primary{background:#e8f5e9;border-color:#c5e1c5;color:#1b5e20}
    .btn.primary.sel{background:#cde9cd;border-color:#8dc28d}
    .small{font-size:12px;color:var(--muted)}
    .totals{margin-left:auto;font-weight:600}
  </style>
</head>
<body>
  <h1>SynBio Wargame — Team Builder <span class="pill">v2</span></h1>

  <div class="bar box" style="background:#fff">
    <label>Team: <input id="team" placeholder="Red or Blue"></label>
    <label>Round: <input id="round" type="number" value="1" min="1" style="width:90px"></label>
    <button id="check" class="btn" onclick="checkRound()">Check Round Status</button>
    <span id="status" class="small"></span>
  </div>

  <div id="deadlineBox" class="box" style="display:none">
    <b>Counter Window:</b> <span id="countdown" class="timer">--:--</span>
  </div>

  <div class="box">
    <h2>Threat Build <span class="pill">one per team/round</span></h2>
    <div class="small" style="margin-bottom:8px">Tap an option to read more; press <b>Select</b> to add it to your build.</div>
    <div class="opts" id="threatOpts"></div>
    <div class="bar" style="margin-top:8px">
      <button class="btn primary" onclick="submitBuild('THREAT')">Submit Threat</button>
      <span class="totals">Power: <b id="threatPower">0</b> | Cost: <b id="threatCost">0</b></span>
    </div>
  </div>

  <div class="box">
    <h2>Counter Build <span class="pill">one per team/round</span></h2>
    <div class="small" style="margin-bottom:8px">Tap to view why/when to use it; press <b>Select</b> to add.</div>
    <div class="opts" id="counterOpts"></div>
    <div class="bar" style="margin-top:8px">
      <button class="btn primary" onclick="submitBuild('COUNTER')">Submit Counter</button>
      <span class="totals">Power: <b id="counterPower">0</b> | Cost: <b id="counterCost">0</b></span>
    </div>
  </div>

<script>
// >>>> IMPORTANT: replace with your deployed Web App URL
const API_URL = "https://script.google.com/macros/s/AKfycbyhsoxL2cRRhoyK4vgXSZt6oX_HunwrCsVTxLqAcEPbEHI86Z0NRmEVcn69knVTmcfI/exec";

/* THREAT and COUNTER options omitted here for brevity—use the exact arrays from my message or your current file.
   They include name, cost, eff, desc entries. (Same as before, with descriptions.) */

const threatOptions = [
 {name:"Protein Designer", cost:2, eff:2, desc:"Designs novel proteins that may alter host interaction or stability; increases adaptability and can complicate countermeasure targeting."},
  {name:"CRISPR Optimizer", cost:2, eff:2, desc:"Accelerates genome edits to tune traits (e.g., fitness, evasion). Raises adaptability pressure for defenders."},
  {name:"Pathway Simulator", cost:3, eff:3, desc:"Computationally explores metabolic/host pathway effects to maximize impact or persistence."},
  {name:"Lab Automation Robot", cost:3, eff:3, desc:"Scales build/test throughput and consistency; shortens iteration cycles."},
  {name:"E. coli", cost:1, eff:1, desc:"Common engineering chassis; easy to culture and test; low baseline robustness."},
  {name:"Bacillus Spores", cost:2, eff:2, desc:"Spore state improves environmental hardiness and longevity."},
  {name:"Viral Vector", cost:3, eff:3, desc:"Delivery platform that can increase efficiency of genetic material transfer."},
  {name:"Yeast/Algae", cost:2, eff:2, desc:"Alternative chassis with environmental reservoirs and distinct growth niches."},
  {name:"Resistance", cost:3, eff:3, desc:"Traits that lessen susceptibility to medical or decon measures."},
  {name:"Persistence", cost:2, eff:2, desc:"Traits that favor survival or environmental stability over time."},
  {name:"Stealth", cost:3, eff:3, desc:"Reduces detection likelihood or delays diagnostic signal."},
  {name:"Weaponization", cost:4, eff:4, desc:"Aligns multiple features to increase overall impact and operational effectiveness."}

const counterOptions = [
  {name:"Rapid PCR Assay", cost:2, eff:2, desc:"Targeted diagnostics to confirm presence quickly and guide response."},
  {name:"Environmental Biosensors", cost:3, eff:3, desc:"Air/water sensing network for early detection and situational awareness."},
  {name:"Metagenomic Sequencing", cost:4, eff:4, desc:"Broad, hypothesis-free detection for unknown/stealthy signatures."},

  {name:"Antiviral/Antibiotic Stockpile", cost:3, eff:3, desc:"Prepositioned therapeutics to shorten time-to-treatment."},
  {name:"Monoclonal Antibody Therapy", cost:4, eff:4, desc:"Targeted neutralization; effective when a specific epitope is known."},
  {name:"Prophylactic Vaccine Development", cost:5, eff:5, desc:"Enables protective immunity pathway; longer lead time but high payoff."},

  {name:"Standard Chlorine Wash", cost:1, eff:1, desc:"Low-cost surface/environment decontamination; broadly useful."},
  {name:"UV / Heat Treatment", cost:2, eff:2, desc:"Physical inactivation methods; useful where chemical use is constrained."},
  {name:"AI-Designed Enzymatic Decon", cost:3, eff:3, desc:"Tailored enzymes to degrade/neutralize biological materials."},

  {name:"Upgraded PPE", cost:2, eff:2, desc:"Reduces exposure risk for responders and healthcare settings."},
  {name:"Improved Ventilation/Filtration", cost:2, eff:2, desc:"Engineering controls to reduce airborne spread and load."},
  {name:"Strategic Stockpile Logistics", cost:3, eff:3, desc:"Rapid allocation and distribution of resources to points of need."},

  {name:"Rapid Intel Fusion Cell", cost:3, eff:3, desc:"Fuses diagnostic, environmental, and reporting data for faster decisions."},
  {name:"International Health Reporting", cost:2, eff:2, desc:"Cross-border visibility to spot spread and coordinate measures."},
  {name:"Public Risk Communication", cost:2, eff:2, desc:"Guidance that improves compliance and reduces harmful behaviors."}
];

let selThreat = new Set();
let selCounter = new Set();
let timerId = null;

function renderOptions(containerId, setRef, powerId, opts, costId){
  const box = document.getElementById(containerId);
  box.innerHTML = "";
  opts.forEach((o, i)=>{
    const d = document.createElement("details");
    d.className = "opt";
    const s = document.createElement("summary");
    const title = document.createElement("span");
    title.textContent = o.name;

    const meta = document.createElement("span");
    meta.className = "meta";
    meta.innerHTML = `<span class="badge">Cost ${o.cost}</span><span class="badge">Eff ${o.eff}</span>`;

    s.appendChild(title);
    s.appendChild(meta);
    d.appendChild(s);

    const desc = document.createElement("div");
    desc.className = "desc";
    desc.textContent = o.desc || "No details available.";
    d.appendChild(desc);

    const actions = document.createElement("div");
    actions.className = "actions";
    const btn = document.createElement("button");
    btn.className = "btn primary";
    btn.textContent = setRef.has(i) ? "Deselect" : "Select";
    btn.onclick = (ev)=>{
      ev.preventDefault();
      if(setRef.has(i)) setRef.delete(i); else setRef.add(i);
      btn.textContent = setRef.has(i) ? "Deselect" : "Select";
      btn.classList.toggle("sel", setRef.has(i));
      updateTotals(setRef, powerId, costId, opts);
    };
    actions.appendChild(btn);

    const hint = document.createElement("div");
    hint.className = "small";
    hint.textContent = "Tap the row to read more. Use Select to add/remove.";
    actions.appendChild(hint);

    d.appendChild(actions);
    box.appendChild(d);
  });
  updateTotals(setRef, powerId, costId, opts);
}

function sum(mapArr){ return mapArr.reduce((a,b)=>a+b,0); }

function updateTotals(setRef, powerId, costId, opts){
  const power = sum([...setRef].map(j=>opts[j].eff));
  const cost  = sum([...setRef].map(j=>opts[j].cost));
  document.getElementById(powerId).textContent = power;
  document.getElementById(costId).textContent  = cost;
}

renderOptions("threatOpts", selThreat, "threatPower", threatOptions, "threatCost");
renderOptions("counterOpts", selCounter, "counterPower", counterOptions, "counterCost");

async function submitBuild(kind){
  const team  = document.getElementById("team").value.trim();
  const round = document.getElementById("round").value.trim();
  const opts   = (kind==="THREAT") ? threatOptions : counterOptions;
  const setRef = (kind==="THREAT") ? selThreat    : selCounter;

  const picks = [...setRef].map(i => opts[i].name);
  const power = [...setRef].map(i => opts[i].eff).reduce((a,b)=>a+b,0);
  const cost  = [...setRef].map(i => opts[i].cost).reduce((a,b)=>a+b,0);

  const payload = { action:"submit", round, team, kind, selections:picks, power, cost };

  try {
    const resp = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: "data=" + encodeURIComponent(JSON.stringify(payload))
    });
    await resp.text();
    alert(`${kind} build submitted!`);
  } catch (err) {
    alert("Error submitting build (check console).");
    console.error(err);
  }
}

async function checkRound(){
  const round = document.getElementById("round").value.trim();
  if(!round) return;
  try{
    const res = await fetch(`${API_URL}?round=${encodeURIComponent(round)}`);
    const data = await res.json();
    document.getElementById("status").textContent =
      `Status: ${data.status} | Threat by: ${data.threat?.team || '—'} | Counter by: ${data.counter?.team || '—'}`;
    if(data.remainingSeconds != null){
      document.getElementById("deadlineBox").style.display = "block";
      startCountdown(data.remainingSeconds);
    } else {
      document.getElementById("deadlineBox").style.display = "none";
      stopCountdown();
    }
  }catch(e){
    document.getElementById("status").textContent = "Unable to fetch round status.";
  }
}

function startCountdown(sec){
  stopCountdown();
  updateCountdown(sec);
  timerId = setInterval(()=> {
    sec = Math.max(0, sec-1);
    updateCountdown(sec);
    if(sec===0) stopCountdown();
  }, 1000);
}
function stopCountdown(){ if(timerId){ clearInterval(timerId); timerId=null; } }
function updateCountdown(s){
  const m = String(Math.floor(s/60)).padStart(2,'0');
  const ss = String(s%60).padStart(2,'0');
  document.getElementById("countdown").textContent = `${m}:${ss}`;
}
</script>
</body>
</html>


